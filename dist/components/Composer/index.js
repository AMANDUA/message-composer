"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports["default"]=void 0;var _react=_interopRequireDefault(require("react")),_propTypes=_interopRequireDefault(require("prop-types")),_draftJs=require("draft-js"),_draftJsPluginsEditor=_interopRequireDefault(require("draft-js-plugins-editor"));require("draft-js/dist/Draft.css"),require("draft-js-inline-toolbar-plugin/lib/plugin.css");var _draftJsExportHtml=require("draft-js-export-html"),_classnames=_interopRequireDefault(require("classnames"));require("./styles.scss");function _interopRequireDefault(a){return a&&a.__esModule?a:{default:a}}function _typeof(a){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},_typeof(a)}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _defineProperties(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}function _createClass(a,b,c){return b&&_defineProperties(a.prototype,b),c&&_defineProperties(a,c),a}function _possibleConstructorReturn(a,b){return b&&("object"===_typeof(b)||"function"==typeof b)?b:_assertThisInitialized(a)}function _getPrototypeOf(a){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(a){return a.__proto__||Object.getPrototypeOf(a)},_getPrototypeOf(a)}function _assertThisInitialized(a){if(void 0===a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return a}function _inherits(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function");a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,writable:!0,configurable:!0}}),b&&_setPrototypeOf(a,b)}function _setPrototypeOf(a,b){return _setPrototypeOf=Object.setPrototypeOf||function(a,b){return a.__proto__=b,a},_setPrototypeOf(a,b)}var STYLES={BOLD:"BOLD",ITALIC:"ITALIC",UNDERLINE:"UNDERLINE"},Composer=/*#__PURE__*/function(a){function b(a){var c;return _classCallCheck(this,b),c=_possibleConstructorReturn(this,_getPrototypeOf(b).call(this,a)),c.state={editorState:_draftJs.EditorState.createEmpty(),hasFocus:!1},c.onBlur=function(){return c.setState({hasFocus:!1})},c.onFocus=function(){return c.setState({hasFocus:!0})},c.onChange=c.onChange.bind(_assertThisInitialized(c)),c.handleReturn=c.handleReturn.bind(_assertThisInitialized(c)),c.handleKeyCommand=c.handleKeyCommand.bind(_assertThisInitialized(c)),c.toggleInlineStyle=c.toggleInlineStyle.bind(_assertThisInitialized(c)),c.focus=function(){return c.draftEditor.focus()},c}return _inherits(b,a),_createClass(b,[{key:"onChange",value:function onChange(a){if(this.props.active){var b=a.getCurrentInlineStyle(),c=this.state.editorState.getCurrentInlineStyle();b!==c&&this.props.active({bold:b.has(STYLES.BOLD),italic:b.has(STYLES.ITALIC),underline:b.has(STYLES.UNDERLINE)})}this.setState({editorState:a})}},{key:"componentDidMount",value:function componentDidMount(){var a=this;this.props.commands&&this.props.commands({toggleBold:function toggleBold(){return a.toggleInlineStyle(STYLES.BOLD)},toggleItalic:function toggleItalic(){return a.toggleInlineStyle(STYLES.ITALIC)},toggleUnderline:function toggleUnderline(){return a.toggleInlineStyle(STYLES.UNDERLINE)}})}},{key:"handleReturn",value:function handleReturn(a){if(a.altKey||a.metaKey||a.ctrlKey){var b={displayName:this.state.editorState.getCurrentContent().getPlainText(),content:(0,_draftJsExportHtml.stateToHTML)(this.state.editorState.getCurrentContent())};return this.props.send(b),this.setState({editorState:_draftJs.EditorState.createEmpty()}),"handled"}return"not-handled"}},{key:"handleKeyCommand",value:function handleKeyCommand(a,b){var c=_draftJs.RichUtils.handleKeyCommand(b,a);return c?(this.onChange(c),"handled"):"not-handled"}},{key:"toggleInlineStyle",value:function toggleInlineStyle(a){this.onChange(_draftJs.RichUtils.toggleInlineStyle(this.state.editorState,a))}},{key:"render",value:function render(){var a=this,b=(0,_classnames["default"])("draft-root",{"draft-hidePlaceholder":this.state.hasFocus});return _react["default"].createElement("div",{className:b,onClick:this.focus,onKeyPress:this.focus,role:"textbox",tabIndex:-1},_react["default"].createElement(_draftJsPluginsEditor["default"],{handleReturn:this.handleReturn,handleKeyCommand:this.handleKeyCommand,editorState:this.state.editorState,onBlur:this.onBlur,onChange:this.onChange,onFocus:this.onFocus,placeholder:"Write a message here.",ref:function ref(b){a.draftEditor=b}}))}}]),b}(_react["default"].Component);exports["default"]=Composer,Composer.propTypes={send:_propTypes["default"].func.isRequired,commands:_propTypes["default"].func,active:_propTypes["default"].func};